<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Liquid Music — GAZAN</title>
<style>
:root{
  --bg:#06121a; --panel:#0d1720; --glass:rgba(255,255,255,0.04);
  --muted:#9fb0c3; --text:#eaf6ff;
  --accent1:#6ee7ff; --accent2:#a78bfa; --accent3:#22d3ee;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background:
    radial-gradient(800px 400px at 10% 10%, rgba(34,211,238,0.06), transparent 20%),
    radial-gradient(700px 500px at 90% 90%, rgba(167,139,250,0.04), transparent 20%),
    linear-gradient(180deg,var(--bg), #041018 120%);
  color:var(--text); -webkit-font-smoothing:antialiased;
  padding-bottom:120px; /* space for fixed player */
}

/* App container */
.app{max-width:900px;margin:0 auto;padding:18px 16px 140px;}

/* Header */
.header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.logo{
  width:44px;height:44px;border-radius:12px;
  background:conic-gradient(from 200deg,var(--accent1),var(--accent2),var(--accent3));
  box-shadow:0 10px 30px rgba(103,120,255,0.12), inset 0 0 22px rgba(255,255,255,0.06);
}
.title h1{margin:0;font-size:18px;letter-spacing:0.2px}
.title p{margin:0;font-size:13px;color:var(--muted)}

/* Tabs */
.tabs{display:flex;gap:8px;margin:14px 0 18px;overflow:auto}
.tab{
  flex:1;min-width:110px;text-align:center;padding:10px;border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  color:var(--muted);font-weight:600;font-size:13px;cursor:pointer;border:1px solid rgba(255,255,255,0.04)
}
.tab.active{color:var(--text);box-shadow:0 8px 28px rgba(34,211,238,0.06);border:1px solid rgba(110,231,255,0.14)}
.tab:active{transform:translateY(1px)}

/* List rows (liquid style) */
.list{display:flex;flex-direction:column;gap:12px}
.row{
  display:flex;align-items:center;gap:12px;padding:12px;border-radius:14px;position:relative;overflow:hidden;
  background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04);backdrop-filter: blur(6px);
}
.row .cover{width:64px;height:64px;border-radius:10px;flex:0 0 64px;overflow:hidden}
.row img{width:100%;height:100%;object-fit:cover;display:block}
.row .meta{flex:1;min-width:0}
.row .meta .name{font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.row .meta .artist{font-size:13px;color:var(--muted);margin-top:4px}
.row .actions{display:flex;gap:8px;align-items:center}
.row .play-btn{
  width:44px;height:44px;border-radius:50%;border:none;display:inline-grid;place-items:center;
  background:radial-gradient(120% 120% at 20% 20%, rgba(110,231,255,0.12), rgba(167,139,250,0.06));
  box-shadow:0 10px 28px rgba(34,211,238,0.06);cursor:pointer
}

/* blob accents */
.blob-small{
  position:absolute;width:160%;height:160%;left:-30%;top:-30%;pointer-events:none;
  background:radial-gradient(closest-side, rgba(110,231,255,0.10), transparent 40%);
  filter: blur(18px); transform: translateZ(0); animation:float 8s ease-in-out infinite; z-index:0
}
@keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(14px,-10px)}}

/* Player bottom (compact) */
.player{
  position:fixed;left:10px;right:10px;bottom:14px;border-radius:18px;padding:10px;
  background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  display:flex;align-items:center;gap:12px;backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 14px 40px rgba(3,6,10,0.6);
}
.player .thumb{width:56px;height:56px;border-radius:14px;overflow:hidden;flex:0 0 56px}
.player .info{flex:1;min-width:0}
.player .info .t{font-weight:700;font-size:15px}
.player .info .a{font-size:12px;color:var(--muted);margin-top:4px}
.player .controls{display:flex;gap:10px;align-items:center}
.icon-btn{
  width:46px;height:46px;border-radius:50%;border:none;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));
  display:grid;place-items:center;color:var(--text);cursor:pointer
}

/* Progress */
.progress{height:6px;background:rgba(255,255,255,0.06);border-radius:10px;overflow:hidden;margin-top:8px}
.progress .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 0 18px rgba(110,231,255,0.24);transition:width .12s linear}

/* Fullscreen player modal */
.modal{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:22px;
  background:linear-gradient(180deg, rgba(2,6,8,0.6), rgba(0,0,0,0.85));
  z-index:120; visibility:hidden;opacity:0;transition:opacity .22s ease, visibility .22s;
}
.modal.open{visibility:visible;opacity:1}
.modal-card{
  width:100%;max-width:920px;border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.05);backdrop-filter:blur(14px);
  display:flex;flex-direction:column;gap:12px;align-items:stretch;
  max-height:92vh;overflow:hidden;
}
.modal-top{display:flex;gap:12px;align-items:center}
.modal-cover{width:120px;height:120px;border-radius:14px;overflow:hidden;flex:0 0 120px}
.modal-info .title{font-size:20px;font-weight:800}
.modal-info .artist{color:var(--muted);margin-top:6px}
.canvas-wrap{width:100%;height:220px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));display:flex;align-items:center;justify-content:center}

/* big controls */
.big-controls{display:flex;align-items:center;gap:14px;justify-content:center;padding:6px}
.big-btn{width:64px;height:64px;border-radius:50%;border:none;background:radial-gradient(circle at 20% 20%, rgba(110,231,255,0.18), rgba(167,139,250,0.08));display:grid;place-items:center;font-size:18px;cursor:pointer}
.small-btn{width:44px;height:44px;border-radius:10px;border:none;background:rgba(255,255,255,0.02);cursor:pointer}

/* responsive tweaks */
@media (min-width:720px){
  .app{padding-left:28px;padding-right:28px}
  .modal-card{flex-direction:row;gap:18px;padding:22px}
  .canvas-wrap{height:300px;flex:1}
  .modal-info{flex:0 0 320px}
}
</style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="logo" aria-hidden></div>
    <div class="title">
      <h1>Liquid Player</h1>
      <p>GAZAN — TUNG TUNG TUNG SAHUR (Humba)</p>
    </div>
  </header>

  <div class="tabs" role="tablist">
    <div class="tab active" data-target="trending" role="tab">В тренде</div>
    <div class="tab" data-target="all" role="tab">Вся музыка</div>
    <div class="tab" data-target="profile" role="tab">Мой профиль</div>
  </div>

  <section id="trending" class="list" aria-labelledby="trending" >
    <!-- initially пустой, но трек тоже показывается здесь как тренд (по запросу) -->
    <div class="row" onclick="playAndOpen('Humba.mp3')" role="button" tabindex="0">
      <div class="blob-small"></div>
      <div class="cover"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP8N2cSCOjyG5P8yhpGsCSFd6GMuhI2gvVkAdMI-CcCA&s=10" alt="cover"></div>
      <div class="meta">
        <div class="name">TUNG TUNG TUNG SAHUR</div>
        <div class="artist">GAZAN</div>
        <div style="font-size:12px;color:var(--muted);margin-top:6px">В тренде · скоро добавится больше треков</div>
      </div>
      <div class="actions">
        <button class="play-btn" onclick="event.stopPropagation(); playTrack('Humba.mp3')">▶</button>
      </div>
    </div>
    <!-- placeholder text -->
    <div style="color:var(--muted);padding:6px 2px;font-size:13px">Пока пусто — добавляй новые треки в репозиторий, они появятся здесь.</div>
  </section>

  <section id="all" class="list" style="display:none">
    <!-- длинный список — дублируем строку для скролла/внешнего вида -->
    <!-- главное — источник трека: относительный путь Humba.mp3 (и fallback humba.mp3) -->
    <script id="rows-template" type="text/template">
      <div class="row" onclick="playAndOpen('Humba.mp3')">
        <div class="blob-small"></div>
        <div class="cover"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP8N2cSCOjyG5P8yhpGsCSFd6GMuhI2gvVkAdMI-CcCA&s=10" alt="cover"></div>
        <div class="meta">
          <div class="name">TUNG TUNG TUNG SAHUR</div>
          <div class="artist">GAZAN</div>
        </div>
        <div class="actions">
          <button class="play-btn" onclick="event.stopPropagation(); playTrack('Humba.mp3')">▶</button>
        </div>
      </div>
    </script>
  </section>

  <section id="profile" class="list" style="display:none">
    <div class="row" style="align-items:flex-start">
      <div style="flex:0 0 72px">
        <div style="width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));"></div>
      </div>
      <div class="meta">
        <div class="name">Еремей</div>
        <div class="artist">Создатель репозитория</div>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">Статистика: треков 1 · прослушиваний локально — <span id="plays-count">0</span></div>
      </div>
    </div>
  </section>
</div>

<!-- Compact bottom player -->
<div class="player" id="compactPlayer" aria-hidden="false">
  <div class="thumb" id="compactThumb"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP8N2cSCOjyG5P8yhpGsCSFd6GMuhI2gvVkAdMI-CcCA&s=10" alt="cover" style="width:100%;height:100%;object-fit:cover"></div>
  <div class="info">
    <div class="t" id="cp-title">Нет трека</div>
    <div class="a" id="cp-artist"></div>
    <div class="progress" id="cp-progress"><div class="bar" id="cp-bar"></div></div>
  </div>
  <div class="controls">
    <button class="icon-btn" id="prevBtn" title="Предыдущий" onclick="prevTrack()">⏮</button>
    <button class="icon-btn" id="playBtn" title="Воспроизвести" onclick="togglePlay()">▶️</button>
    <button class="icon-btn" id="nextBtn" title="Следующий" onclick="nextTrack()">⏭</button>
    <button class="icon-btn" title="Открыть" onclick="openFull()">⤢</button>
  </div>
</div>

<!-- Fullscreen modal player -->
<div class="modal" id="modal">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div class="modal-info" style="display:flex;flex-direction:column;gap:12px">
      <div class="modal-top">
        <div class="modal-cover"><img id="modal-cover" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP8N2cSCOjyG5P8yhpGsCSFd6GMuhI2gvVkAdMI-CcCA&s=10" alt="cover" style="width:100%;height:100%;object-fit:cover"></div>
        <div style="flex:1">
          <div class="title" id="modal-title">TUNG TUNG TUNG SAHUR</div>
          <div class="artist" id="modal-artist">GAZAN</div>
          <div style="margin-top:8px;color:var(--muted)">Источник: Humba.mp3 (репозиторий)</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button class="small-btn" onclick="togglePlay()">⏯</button>
        <button class="small-btn" onclick="seekRelative(-10)">⏪ 10s</button>
        <button class="small-btn" onclick="seekRelative(10)">10s ⏩</button>
        <div style="flex:1"></div>
        <button class="small-btn" onclick="closeFull()">✕</button>
      </div>

      <div class="canvas-wrap">
        <canvas id="vis" width="800" height="300" style="width:100%;height:100%"></canvas>
      </div>

      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;gap:12px;align-items:center;justify-content:center" class="big-controls">
          <button class="big-btn" onclick="prevTrack()">⏮</button>
          <button class="big-btn" id="bigPlay" onclick="togglePlay()">▶️</button>
          <button class="big-btn" onclick="nextTrack()">⏭</button>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <div style="flex:1" class="progress"><div id="modal-bar" class="bar" style="width:0%"></div></div>
          <div style="width:56px;text-align:right;color:var(--muted)" id="timeLabel">0:00</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Audio element and script -->
<audio id="audio" crossorigin="anonymous"></audio>

<script>
/* Playlist — сейчас один трек, источник: относительный путь "Humba.mp3".
   Если в репозитории имя файла "humba.mp3", браузер загрузит корректно при регистре в системе.
*/
const playlist = [
  { src: 'Humba.mp3', alt: 'humba.mp3', title: 'TUNG TUNG TUNG SAHUR', artist: 'GAZAN',
    cover: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRP8N2cSCOjyG5P8yhpGsCSFd6GMuhI2gvVkAdMI-CcCA&s=10' }
];

let idx = 0;
let plays = 0;

const audio = document.getElementById('audio');
const cpTitle = document.getElementById('cp-title');
const cpArtist = document.getElementById('cp-artist');
const cpBar = document.getElementById('cp-bar');
const cpProgress = document.getElementById('cp-progress');
const playBtn = document.getElementById('playBtn');
const bigPlay = document.getElementById('bigPlay');
const compactThumb = document.getElementById('compactThumb');
const modal = document.getElementById('modal');
const visCanvas = document.getElementById('vis');
const modalBar = document.getElementById('modal-bar');
const timeLabel = document.getElementById('timeLabel');
const playsCountEl = document.getElementById('plays-count');

// init UI
function setTrackUI(track){
  cpTitle.textContent = track.title;
  cpArtist.textContent = track.artist;
  document.getElementById('modal-title').textContent = track.title;
  document.getElementById('modal-artist').textContent = track.artist;
  document.getElementById('modal-cover').src = track.cover;
  compactThumb.querySelector('img').src = track.cover;
}

// attempt to load src — try exact then fallback lowercase
function resolveSrc(entry){
  return fetch(entry.src, {method:'HEAD'}).then(r=>{
    if(r.ok) return entry.src;
    // try alt
    return fetch(entry.alt, {method:'HEAD'}).then(r2=>r2.ok?entry.alt:entry.src).catch(()=>entry.src);
  }).catch(()=>entry.src);
}

// load current track (with HEAD probe for correct case when possible)
async function loadTrack(i){
  const entry = playlist[i];
  const src = await resolveSrc(entry);
  audio.src = src;
  audio.load();
  setTrackUI(entry);
  updateProgress(0,0);
}

// play track quick (compact)
function playTrack(src){
  // if custom src provided — set one-shot (not needed here)
  audio.src = src;
  audio.play().catch(()=>{});
}

// play and open modal
async function playAndOpen(src){
  await loadTrack(idx);
  openFull();
  audio.play().then(()=>{}).catch(()=>{});
}

// next/prev (only single track now)
function nextTrack(){ idx = (idx + 1) % playlist.length; loadTrack(idx); audio.play().catch(()=>{}); }
function prevTrack(){ idx = (idx - 1 + playlist.length) % playlist.length; loadTrack(idx); audio.play().catch(()=>{}); }

// toggle play/pause
function togglePlay(){
  if(!audio.src) { loadTrack(idx).then(()=>audio.play()); return; }
  if(audio.paused){ audio.play(); } else { audio.pause(); }
}

// seek relative seconds
function seekRelative(sec){ audio.currentTime = Math.max(0, Math.min(audio.duration || 0, audio.currentTime + sec)); }

// progress update
function updateProgress(current, duration){
  const pct = duration ? (current/duration)*100 : 0;
  cpBar.style.width = pct + '%';
  modalBar.style.width = pct + '%';
  timeLabel.textContent = formatTime(current) + ' / ' + formatTime(duration);
}

// format time
function formatTime(s){
  if(!isFinite(s)) return '0:00';
  const m = Math.floor(s/60); const sec = Math.floor(s%60);
  return m + ':' + String(sec).padStart(2,'0');
}

// audio events
audio.addEventListener('play', ()=>{ playBtn.textContent = '⏸'; bigPlay.textContent='⏸';++plays; playsCountEl.textContent = plays; });
audio.addEventListener('pause', ()=>{ playBtn.textContent = '▶️'; bigPlay.textContent='▶️'; });
audio.addEventListener('timeupdate', ()=>{ updateProgress(audio.currentTime, audio.duration || 0); });
audio.addEventListener('ended', ()=>{ nextTrack(); audio.play().catch(()=>{}); });

// click on progress (compact)
cpProgress.addEventListener('pointerdown', (e)=>{
  const rect = cpProgress.getBoundingClientRect();
  const x = (e.clientX - rect.left); const pct = x/rect.width;
  if(audio.duration) audio.currentTime = pct * audio.duration;
});

// Tabs handling
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('section').forEach(s=>s.style.display='none');
    const target = document.getElementById(t.dataset.target);
    if(target) target.style.display = 'flex';
    // special: fill 'all' with many rows to simulate long list
    if(t.dataset.target === 'all' && !document.getElementById('all').dataset.filled){
      fillAllRows(18); document.getElementById('all').dataset.filled = '1';
    }
  });
});

// fill many rows function
function fillAllRows(count){
  const template = document.getElementById('rows-template').innerHTML;
  const container = document.getElementById('all');
  for(let i=0;i<count;i++){
    const div = document.createElement('div');
    div.innerHTML = template;
    // attach event listeners for nested play buttons
    div.firstElementChild.addEventListener('click', ()=>{ loadTrack(0); audio.play().catch(()=>{}); openFull(); });
    const btn = div.querySelector('.play-btn');
    if(btn){ btn.addEventListener('click', (ev)=>{ ev.stopPropagation(); loadTrack(0); audio.play().catch(()=>{}); }); }
    container.appendChild(div.firstElementChild);
  }
}

// modal open/close
function openFull(){ modal.classList.add('open'); startVis();}
function closeFull(){ modal.classList.remove('open'); stopVis(); }

// keyboard escape to close modal
window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeFull(); });

// initial load
loadTrack(0);

// WebAudio visualization (spectrum + waveform blend)
let audioCtx, analyser, sourceNode, dataArray, rafId;
const canvas = visCanvas;
const ctx = canvas.getContext('2d');

function startVis(){
  if(rafId) return;
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
  }
  if(!sourceNode || sourceNode.mediaElement !== audio){
    try{
      sourceNode = audioCtx.createMediaElementSource(audio);
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);
    }catch(e){}
  }
  // resume context on user interaction
  if(audioCtx.state === 'suspended'){ audioCtx.resume().catch(()=>{}); }
  draw();
}

function stopVis(){
  if(rafId) cancelAnimationFrame(rafId);
  rafId = null;
  // clear canvas
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function draw(){
  rafId = requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);

  // canvas size adapt
  const dpr = window.devicePixelRatio || 1;
  const w = canvas.clientWidth * dpr;
  const h = canvas.clientHeight * dpr;
  if(canvas.width !== w || canvas.height !== h){ canvas.width = w; canvas.height = h; }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // gradient background waves
  const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  grad.addColorStop(0, 'rgba(110,231,255,0.06)');
  grad.addColorStop(0.6, 'rgba(167,139,250,0.04)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // draw waveform-like curve using frequency data
  ctx.lineWidth = 2 * dpr;
  ctx.strokeStyle = 'rgba(255,255,255,0.92)';
  ctx.beginPath();
  const step = Math.max(1, Math.floor(dataArray.length / (canvas.width / (4*dpr))));
  let x = 0;
  for(let i=0;i<dataArray.length;i+=step){
    const v = dataArray[i] / 255.0;
    const y = canvas.height - (v * canvas.height * 0.85) - (Math.sin(i/5 + performance.now()/500)*8*dpr);
    if(x===0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    x += (canvas.width / Math.ceil(dataArray.length/step));
  }
  ctx.stroke();

  // top glow blobs from peaks
  const peak = Math.max(...dataArray);
  if(peak > 160){
    ctx.fillStyle = 'rgba(110,231,255,0.08)';
    ctx.beginPath();
    ctx.ellipse(canvas.width*0.5, canvas.height*0.35, peak*1.2*dpr, peak*0.8*dpr, 0, 0, Math.PI*2);
    ctx.fill();
  }
}

// household: keep UI in sync if track metadata loads
audio.addEventListener('loadedmetadata', ()=>{ updateProgress(audio.currentTime || 0, audio.duration || 0); });

// touch-friendly: double-tap cover to open full
document.querySelectorAll('.row .cover, .player .thumb').forEach(el=>{
  el.addEventListener('dblclick', ()=>openFull());
});

// accessibility: allow Enter to activate rows
document.querySelectorAll('.row').forEach(r=>{
  r.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { loadTrack(0); audio.play().catch(()=>{}); openFull(); }});
});
</script>
</body>
</html>
